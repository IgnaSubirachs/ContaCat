<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balan√ß de Situaci√≥ - ERP</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <nav>
        <div style="font-weight: 700; font-size: 1.2rem;">ERP Catal√†</div>
        <div>
            <a href="/">Inici</a>
            <a href="/accounting">Comptabilitat</a>
        </div>
    </nav>

    <div class="container">
        <a href="/accounting" class="back-link">‚Üê Tornar a Comptabilitat</a>

        <h1>Balan√ß de Situaci√≥</h1>
        <p>
            {% if balance_sheet.end_date %}
            Data de tancament: {{ balance_sheet.end_date.strftime('%d/%m/%Y') }}
            {% else %}
            Situaci√≥ actual
            {% endif %}
        </p>

        <div class="filter-section">
            <form method="get" action="/accounting/reports/balance-sheet"
                style="display: flex; align-items: center; gap: 1rem; width: 100%;">
                <label for="end_date">Data de tancament:</label>
                <input type="date" id="end_date" name="end_date"
                    value="{{ balance_sheet.end_date.isoformat() if balance_sheet.end_date else '' }}">
                <button type="submit" class="btn">Filtrar</button>
            </form>
        </div>

        <div class="export-buttons">
            <a href="/accounting/reports/balance-sheet/export?format=pdf{% if balance_sheet.end_date %}&end_date={{ balance_sheet.end_date.isoformat() }}{% endif %}"
                class="export-btn pdf">üìÑ Exportar PDF</a>
            <a href="/accounting/reports/balance-sheet/export?format=excel{% if balance_sheet.end_date %}&end_date={{ balance_sheet.end_date.isoformat() }}{% endif %}"
                class="export-btn excel">üìä Exportar Excel</a>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <!-- ACTIU -->
            <div class="section">
                <div class="section-title">ACTIU</div>

                <div class="subsection-title">Actiu No Corrent</div>
                <table>
                    <tbody>
                        {% for group_name, group_data in balance_sheet.actiu.no_corrent.groups.items() %}
                        <tr class="group-header">
                            <td colspan="3">{{ group_name }}</td>
                        </tr>
                        {% for account in group_data.accounts %}
                        <tr>
                            <td style="padding-left: 20px;">{{ account.code }}</td>
                            <td>{{ account.name }}</td>
                            <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                        </tr>
                        {% endfor %}
                        <tr class="group-total">
                            <td colspan="2" style="padding-left: 20px;">Total {{ group_name }}</td>
                            <td class="amount">{{ "%.2f"|format(group_data.total) }} ‚Ç¨</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha comptes</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td colspan="2">Total Actiu No Corrent</td>
                            <td class="amount">{{ "%.2f"|format(balance_sheet.actiu.no_corrent.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>

                <div class="subsection-title">Actiu Corrent</div>
                <table>
                    <tbody>
                        {% for group_name, group_data in balance_sheet.actiu.corrent.groups.items() %}
                        <tr class="group-header">
                            <td colspan="3">{{ group_name }}</td>
                        </tr>
                        {% for account in group_data.accounts %}
                        <tr>
                            <td style="padding-left: 20px;">{{ account.code }}</td>
                            <td>{{ account.name }}</td>
                            <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                        </tr>
                        {% endfor %}
                        <tr class="group-total">
                            <td colspan="2" style="padding-left: 20px;">Total {{ group_name }}</td>
                            <td class="amount">{{ "%.2f"|format(group_data.total) }} ‚Ç¨</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha comptes</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td colspan="2">Total Actiu Corrent</td>
                            <td class="amount">{{ "%.2f"|format(balance_sheet.actiu.corrent.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>

                <table>
                    <tbody>
                        <tr class="grand-total">
                            <td colspan="2">TOTAL ACTIU</td>
                            <td class="amount">{{ "%.2f"|format(balance_sheet.actiu.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- PASSIU I PATRIMONI NET -->
            <div class="section">
                <div class="section-title">PATRIMONI NET I PASSIU</div>

                <div class="subsection-title">Patrimoni Net</div>
                <table>
                    <tbody>
                        {% for group_name, group_data in
                        balance_sheet.patrimoni_net_i_passiu.patrimoni_net.groups.items() %}
                        <tr class="group-header">
                            <td colspan="3">{{ group_name }}</td>
                        </tr>
                        {% for account in group_data.accounts %}
                        <tr>
                            <td style="padding-left: 20px;">{{ account.code }}</td>
                            <td>{{ account.name }}</td>
                            <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                        </tr>
                        {% endfor %}
                        <tr class="group-total">
                            <td colspan="2" style="padding-left: 20px;">Total {{ group_name }}</td>
                            <td class="amount">{{ "%.2f"|format(group_data.total) }} ‚Ç¨</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha comptes</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td colspan="2">Total Patrimoni Net</td>
                            <td class="amount">{{
                                "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.patrimoni_net.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>

                <div class="subsection-title">Passiu No Corrent</div>
                <table>
                    <tbody>
                        {% for group_name, group_data in
                        balance_sheet.patrimoni_net_i_passiu.passiu_no_corrent.groups.items() %}
                        <tr class="group-header">
                            <td colspan="3">{{ group_name }}</td>
                        </tr>
                        {% for account in group_data.accounts %}
                        <tr>
                            <td style="padding-left: 20px;">{{ account.code }}</td>
                            <td>{{ account.name }}</td>
                            <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                        </tr>
                        {% endfor %}
                        <tr class="group-total">
                            <td colspan="2" style="padding-left: 20px;">Total {{ group_name }}</td>
                            <td class="amount">{{ "%.2f"|format(group_data.total) }} ‚Ç¨</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha comptes</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td colspan="2">Total Passiu No Corrent</td>
                            <td class="amount">{{
                                "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.passiu_no_corrent.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>

                <div class="subsection-title">Passiu Corrent</div>
                <table>
                    <tbody>
                        {% for group_name, group_data in
                        balance_sheet.patrimoni_net_i_passiu.passiu_corrent.groups.items() %}
                        <tr class="group-header">
                            <td colspan="3">{{ group_name }}</td>
                        </tr>
                        {% for account in group_data.accounts %}
                        <tr>
                            <td style="padding-left: 20px;">{{ account.code }}</td>
                            <td>{{ account.name }}</td>
                            <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                        </tr>
                        {% endfor %}
                        <tr class="group-total">
                            <td colspan="2" style="padding-left: 20px;">Total {{ group_name }}</td>
                            <td class="amount">{{ "%.2f"|format(group_data.total) }} ‚Ç¨</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha comptes</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td colspan="2">Total Passiu Corrent</td>
                            <td class="amount">{{
                                "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.passiu_corrent.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>

                <table>
                    <tbody>
                        <tr class="total-row">
                            <td colspan="2">TOTAL PASSIU</td>
                            <td class="amount">{{
                                "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.passiu_no_corrent.total +
                                balance_sheet.patrimoni_net_i_passiu.passiu_corrent.total) }} ‚Ç¨</td>
                        </tr>
                        <tr class="grand-total">
                            <td colspan="2">TOTAL PATRIMONI NET I PASSIU</td>
                            <td class="amount">{{ "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.total) }} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="summary">
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Resum del Balan√ß</h3>
            <div class="summary-item">
                <span>Total Actiu:</span>
                <span class="amount">{{ "%.2f"|format(balance_sheet.actiu.total) }} ‚Ç¨</span>
            </div>
            <div class="summary-item">
                <span>Total Patrimoni Net:</span>
                <span class="amount">{{ "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.patrimoni_net.total) }}
                    ‚Ç¨</span>
            </div>
            <div class="summary-item">
                <span>Total Passiu:</span>
                <span class="amount">{{ "%.2f"|format(balance_sheet.patrimoni_net_i_passiu.passiu_no_corrent.total +
                    balance_sheet.patrimoni_net_i_passiu.passiu_corrent.total) }} ‚Ç¨</span>
            </div>
            <div class="summary-item total">
                <span>Equilibri (ha de ser 0):</span>
                <span class="amount">{{ "%.2f"|format(balance_sheet.actiu.total -
                    balance_sheet.patrimoni_net_i_passiu.total) }} ‚Ç¨</span>
            </div>
        </div>
    </div>
</body>

</html>