<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compte de P√®rdues i Guanys - ERP</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <nav>
        <div style="font-weight: 700; font-size: 1.2rem;">ERP Catal√†</div>
        <div>
            <a href="/">Inici</a>
            <a href="/accounting">Comptabilitat</a>
        </div>
    </nav>

    <div class="container">
        <a href="/accounting" class="back-link">‚Üê Tornar a Comptabilitat</a>

        <h1>Compte de P√®rdues i Guanys</h1>
        <p>
            {% if profit_loss.start_date and profit_loss.end_date %}
            Per√≠ode: {{ profit_loss.start_date.strftime('%d/%m/%Y') }} - {{ profit_loss.end_date.strftime('%d/%m/%Y') }}
            {% elif profit_loss.end_date %}
            Fins a: {{ profit_loss.end_date.strftime('%d/%m/%Y') }}
            {% else %}
            Tot el per√≠ode
            {% endif %}
        </p>

        <div class="filter-section">
            <form method="get" action="/accounting/reports/profit-loss"
                style="display: flex; align-items: center; gap: 1rem; width: 100%;">
                <label for="start_date">Data inici:</label>
                <input type="date" id="start_date" name="start_date"
                    value="{{ profit_loss.start_date.isoformat() if profit_loss.start_date else '' }}">

                <label for="end_date">Data fi:</label>
                <input type="date" id="end_date" name="end_date"
                    value="{{ profit_loss.end_date.isoformat() if profit_loss.end_date else '' }}">

                <button type="submit" class="btn">Filtrar</button>
            </form>
        </div>

        <div class="export-buttons">
            <a href="/accounting/reports/profit-loss/export?format=pdf{% if profit_loss.start_date %}&start_date={{ profit_loss.start_date.isoformat() }}{% endif %}{% if profit_loss.end_date %}&end_date={{ profit_loss.end_date.isoformat() }}{% endif %}"
                class="export-btn pdf">üìÑ Exportar PDF</a>
            <a href="/accounting/reports/profit-loss/export?format=excel{% if profit_loss.start_date %}&start_date={{ profit_loss.start_date.isoformat() }}{% endif %}{% if profit_loss.end_date %}&end_date={{ profit_loss.end_date.isoformat() }}{% endif %}"
                class="export-btn excel">üìä Exportar Excel</a>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="label">Resultat d'Explotaci√≥</div>
                <div class="value {{ 'positive' if profit_loss.resultat_explotacio >= 0 else 'negative' }}">
                    {{ "%.2f"|format(profit_loss.resultat_explotacio) }} ‚Ç¨
                </div>
            </div>
            <div class="summary-card">
                <div class="label">Resultat Financer</div>
                <div class="value {{ 'positive' if profit_loss.resultat_financer >= 0 else 'negative' }}">
                    {{ "%.2f"|format(profit_loss.resultat_financer) }} ‚Ç¨
                </div>
            </div>
            <div class="summary-card total">
                <div class="label">Resultat de l'Exercici</div>
                <div class="value {{ 'positive' if profit_loss.resultat_exercici >= 0 else 'negative' }}">
                    {{ "%.2f"|format(profit_loss.resultat_exercici) }} ‚Ç¨
                </div>
            </div>
        </div>

        <div class="report-container">
            <h3>A) OPERACIONS CONTINUADES</h3>

            <table class="report-table">
                <thead>
                    <tr>
                        <th style="width: 60%">Partida</th>
                        <th style="width: 20%; text-align: right;">Nota</th>
                        <th style="width: 20%; text-align: right;">Import</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group_name, group_data in profit_loss.groups.items()|sort %}
                    <tr class="group-row">
                        <td colspan="2" class="group-name">{{ group_name }}</td>
                        <td class="amount {{ 'positive' if group_data.total >= 0 else 'negative' }}">
                            {{ "%.2f"|format(group_data.total) }} ‚Ç¨
                        </td>
                    </tr>
                    {% for item in group_data.items %}
                    <tr class="item-row">
                        <td class="item-name">
                            <span class="account-code">{{ item.code }}</span> {{ item.name }}
                        </td>
                        <td></td>
                        <td class="amount sub-amount">
                            {{ "%.2f"|format(item.amount) }} ‚Ç¨
                        </td>
                    </tr>
                    {% endfor %}
                    {% endfor %}

                    <tr class="result-row">
                        <td colspan="2">A.1) RESULTAT D'EXPLOTACI√ì</td>
                        <td class="amount {{ 'positive' if profit_loss.resultat_explotacio >= 0 else 'negative' }}">
                            {{ "%.2f"|format(profit_loss.resultat_explotacio) }} ‚Ç¨
                        </td>
                    </tr>

                    <tr class="result-row">
                        <td colspan="2">A.2) RESULTAT FINANCER</td>
                        <td class="amount {{ 'positive' if profit_loss.resultat_financer >= 0 else 'negative' }}">
                            {{ "%.2f"|format(profit_loss.resultat_financer) }} ‚Ç¨
                        </td>
                    </tr>

                    <tr class="result-row grand-total">
                        <td colspan="2">A.3) RESULTAT ABANS D'IMPOSTOS</td>
                        <td class="amount {{ 'positive' if profit_loss.resultat_abans_impostos >= 0 else 'negative' }}">
                            {{ "%.2f"|format(profit_loss.resultat_abans_impostos) }} ‚Ç¨
                        </td>
                    </tr>

                    <tr class="result-row grand-total final">
                        <td colspan="2">A.4) RESULTAT DE L'EXERCICI</td>
                        <td class="amount {{ 'positive' if profit_loss.resultat_exercici >= 0 else 'negative' }}">
                            {{ "%.2f"|format(profit_loss.resultat_exercici) }} ‚Ç¨
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <style>
            .summary-cards {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .summary-card {
                background: white;
                padding: 1.5rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                border-left: 4px solid #e5e5ea;
            }

            .summary-card.total {
                border-left-color: var(--primary-color);
                background: #f8f9fa;
            }

            .summary-card .label {
                color: var(--text-secondary);
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .summary-card .value {
                font-size: 1.5rem;
                font-weight: 700;
            }

            .value.positive {
                color: #34c759;
            }

            .value.negative {
                color: #ff3b30;
            }

            .report-table {
                width: 100%;
                border-collapse: collapse;
                background: white;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .report-table th {
                background: #f2f2f7;
                padding: 12px 16px;
                text-align: left;
                font-weight: 600;
                color: var(--text-secondary);
                font-size: 0.85rem;
                text-transform: uppercase;
            }

            .group-row td {
                background: #f9f9fb;
                font-weight: 600;
                color: var(--text-primary);
                padding: 12px 16px;
                border-bottom: 1px solid #e5e5ea;
            }

            .item-row td {
                padding: 8px 16px 8px 32px;
                color: var(--text-secondary);
                font-size: 0.95rem;
                border-bottom: 1px solid #f2f2f7;
            }

            .account-code {
                display: inline-block;
                min-width: 60px;
                opacity: 0.7;
                font-family: monospace;
            }

            .amount {
                font-family: 'SF Mono', 'Menlo', monospace;
                font-weight: 600;
                text-align: right;
            }

            .sub-amount {
                font-weight: 400;
                opacity: 0.8;
            }

            .result-row td {
                background: #e5e5ea;
                /* Darker gray for results */
                font-weight: 700;
                padding: 16px;
                text-transform: uppercase;
            }

            .grand-total td {
                background: #d1d1d6;
                font-size: 1.1rem;
            }

            .grand-total.final td {
                background: var(--primary-color);
                color: white;
            }

            .grand-total.final .amount {
                color: white;
            }
        </style>
</body>

</html>