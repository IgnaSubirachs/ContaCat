{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1><i class="fas fa-book me-2"></i>Llibre Diari</h1>
        <p class="text-muted">Registre cronològic d'assentaments comptables</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="/accounting/journal/create" class="btn btn-primary">
            <i class="fas fa-plus me-1"></i> Nou Assentament
        </a>
    </div>
</div>

{% if entries %}
{% for entry in entries %}
<div class="card shadow-sm mb-4 border-start border-primary border-4">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <div>
            <span class="h5 mb-0 text-primary fw-bold">Assentament #{{ entry.entry_number }}</span>
            <span class="text-muted small ms-2"><i class="far fa-calendar-alt me-1"></i>{{ entry.entry_date }}</span>
        </div>
        <div>
            {% if entry.status.value == 'DRAFT' %}
            <span class="badge bg-secondary me-2">ESBORRANY</span>
            <form action="/accounting/journal/{{ entry.id }}/post" method="POST" class="d-inline">
                <button type="submit" class="btn btn-sm btn-success">
                    <i class="fas fa-check me-1"></i> Comptabilitzar
                </button>
            </form>
            {% else %}
            <span class="badge bg-success">COMPTABILITZAT</span>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <p class="text-muted mb-3 fst-italic">{{ entry.description }}</p>
        <div class="table-responsive">
            <table class="table table-sm table-hover table-bordered mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 15%;">Compte</th>
                        <th style="width: 45%;">Descripció Apunt</th>
                        <th style="width: 20%;" class="text-end">Deure</th>
                        <th style="width: 20%;" class="text-end">Haver</th>
                    </tr>
                </thead>
                <tbody>
                    {% for line in entry.lines %}
                    <tr>
                        <td class="font-monospace">
                            <a href="/accounting/ledger/{{ line.account_code }}" class="text-decoration-none fw-bold">
                                {{ line.account_code }}
                            </a>
                        </td>
                        <td>{{ line.description }}</td>
                        <td class="text-end">{{ "%.2f"|format(line.debit) if line.debit > 0 else "-" }} €</td>
                        <td class="text-end">{{ "%.2f"|format(line.credit) if line.credit > 0 else "-" }} €</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light">
                    <tr class="fw-bold">
                        <td colspan="2" class="text-end pe-3">Totals:</td>
                        <td class="text-end text-primary">{{ "%.2f"|format(entry.total_debit) }} €</td>
                        <td class="text-end text-primary">{{ "%.2f"|format(entry.total_credit) }} €</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endfor %}

<!-- Pagination (Placeholder) -->
<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
        <li class="page-item disabled"><a class="page-link" href="#">Anterior</a></li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item"><a class="page-link" href="#">Següent</a></li>
    </ul>
</nav>

{% else %}
<div class="text-center py-5">
    <div class="mb-3 text-muted"> <i class="fas fa-book-open fa-3x"></i> </div>
    <h4 class="text-muted">No hi ha assentaments registrats</h4>
    <p class="text-muted">Comença creant el primer assentament comptable.</p>
    <a href="/accounting/journal/create" class="btn btn-primary mt-2">Crear Assentament</a>
</div>
{% endif %}
{% endblock %}