<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compte de P√®rdues i Guanys - ERP</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <nav>
        <div style="font-weight: 700; font-size: 1.2rem;">ERP Catal√†</div>
        <div>
            <a href="/">Inici</a>
            <a href="/accounting">Comptabilitat</a>
        </div>
    </nav>

    <div class="container">
        <a href="/accounting" class="back-link">‚Üê Tornar a Comptabilitat</a>

        <h1>Compte de P√®rdues i Guanys</h1>
        <p>
            {% if profit_loss.start_date and profit_loss.end_date %}
            Per√≠ode: {{ profit_loss.start_date.strftime('%d/%m/%Y') }} - {{ profit_loss.end_date.strftime('%d/%m/%Y') }}
            {% elif profit_loss.end_date %}
            Fins a: {{ profit_loss.end_date.strftime('%d/%m/%Y') }}
            {% else %}
            Tot el per√≠ode
            {% endif %}
        </p>

        <div class="filter-section">
            <form method="get" action="/accounting/reports/profit-loss"
                style="display: flex; align-items: center; gap: 1rem; width: 100%;">
                <label for="start_date">Data inici:</label>
                <input type="date" id="start_date" name="start_date"
                    value="{{ profit_loss.start_date.isoformat() if profit_loss.start_date else '' }}">

                <label for="end_date">Data fi:</label>
                <input type="date" id="end_date" name="end_date"
                    value="{{ profit_loss.end_date.isoformat() if profit_loss.end_date else '' }}">

                <button type="submit" class="btn">Filtrar</button>
            </form>
        </div>

        <div class="export-buttons">
            <a href="/accounting/reports/profit-loss/export?format=pdf{% if profit_loss.start_date %}&start_date={{ profit_loss.start_date.isoformat() }}{% endif %}{% if profit_loss.end_date %}&end_date={{ profit_loss.end_date.isoformat() }}{% endif %}"
                class="export-btn pdf">üìÑ Exportar PDF</a>
            <a href="/accounting/reports/profit-loss/export?format=excel{% if profit_loss.start_date %}&start_date={{ profit_loss.start_date.isoformat() }}{% endif %}{% if profit_loss.end_date %}&end_date={{ profit_loss.end_date.isoformat() }}{% endif %}"
                class="export-btn excel">üìä Exportar Excel</a>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; margin-bottom: 3rem;">
            <div class="summary bg-success" style="margin-top: 0;">
                <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">Total Ingressos</div>
                <div style="font-size: 1.8rem; font-weight: 700; color: #4cd964;">{{
                    "%.2f"|format(profit_loss.total_ingressos) }} ‚Ç¨</div>
            </div>
            <div class="summary bg-danger" style="margin-top: 0;">
                <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">Total Despeses</div>
                <div style="font-size: 1.8rem; font-weight: 700; color: #ff3b30;">{{
                    "%.2f"|format(profit_loss.total_despeses) }} ‚Ç¨</div>
            </div>
            <div class="summary"
                style="margin-top: 0; border-color: {% if profit_loss.resultat >= 0 %}#4cd964{% else %}#ff3b30{% endif %};">
                <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">Resultat Net</div>
                <div
                    style="font-size: 1.8rem; font-weight: 700; color: {% if profit_loss.resultat >= 0 %}#4cd964{% else %}#ff3b30{% endif %};">
                    {{ "%.2f"|format(profit_loss.resultat) }} ‚Ç¨
                </div>
            </div>
        </div>

        <!-- INGRESSOS -->
        <div class="section">
            <div class="section-title" style="color: #4cd964;">üìà INGRESSOS (Grup 7)</div>
            <table>
                <thead>
                    <tr>
                        <th>Compte</th>
                        <th>Nom</th>
                        <th class="amount">Import</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code, account in profit_loss.ingressos.items() %}
                    <tr>
                        <td>{{ account.code }}</td>
                        <td>{{ account.name }}</td>
                        <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha ingressos en aquest per√≠ode
                        </td>
                    </tr>
                    {% endfor %}
                    <tr class="total-row">
                        <td colspan="2">TOTAL INGRESSOS</td>
                        <td class="amount">{{ "%.2f"|format(profit_loss.total_ingressos) }} ‚Ç¨</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- DESPESES -->
        <div class="section">
            <div class="section-title" style="color: #ff3b30;">üìâ DESPESES (Grup 6)</div>
            <table>
                <thead>
                    <tr>
                        <th>Compte</th>
                        <th>Nom</th>
                        <th class="amount">Import</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code, account in profit_loss.despeses.items() %}
                    <tr>
                        <td>{{ account.code }}</td>
                        <td>{{ account.name }}</td>
                        <td class="amount">{{ "%.2f"|format(account.balance) }} ‚Ç¨</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" style="text-align: center; opacity: 0.5;">No hi ha despeses en aquest per√≠ode
                        </td>
                    </tr>
                    {% endfor %}
                    <tr class="total-row">
                        <td colspan="2">TOTAL DESPESES</td>
                        <td class="amount">{{ "%.2f"|format(profit_loss.total_despeses) }} ‚Ç¨</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- RESULTAT -->
        <div class="summary"
            style="text-align: center; border-color: {% if profit_loss.resultat >= 0 %}#4cd964{% else %}#ff3b30{% endif %};">
            <div style="font-size: 1.5rem; margin-bottom: 1rem; color: var(--text-primary);">
                {% if profit_loss.resultat >= 0 %}
                ‚úÖ RESULTAT POSITIU (Benefici)
                {% else %}
                ‚ö†Ô∏è RESULTAT NEGATIU (P√®rdua)
                {% endif %}
            </div>
            <div
                style="font-size: 3rem; font-weight: 700; color: {% if profit_loss.resultat >= 0 %}#4cd964{% else %}#ff3b30{% endif %}; font-family: 'Consolas', monospace;">
                {{ "%.2f"|format(profit_loss.resultat|abs) }} ‚Ç¨
            </div>
            <div style="margin-top: 1rem; color: var(--text-secondary);">
                Ingressos ({{ "%.2f"|format(profit_loss.total_ingressos) }} ‚Ç¨) -
                Despeses ({{ "%.2f"|format(profit_loss.total_despeses) }} ‚Ç¨)
            </div>
        </div>
    </div>
</body>

</html>